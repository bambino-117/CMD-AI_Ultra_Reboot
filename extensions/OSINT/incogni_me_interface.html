<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incogni-Me - Gestion Empreinte Num√©rique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #581c87 0%, #7c3aed 100%);
            color: #E2E8F0;
        }
        .incogni-glow { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
    </style>
</head>
<body class="min-h-screen p-4">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-purple-900/50 backdrop-blur rounded-2xl p-6 mb-6 border border-purple-500 incogni-glow">
            <h1 class="text-4xl font-bold text-white flex items-center mb-4">
                <span class="text-purple-400 mr-3">üïµÔ∏è</span>
                Incogni-Me
                <span class="text-purple-400 ml-3">üîí</span>
            </h1>
            <p class="text-purple-200 text-lg">
                Gestion de votre empreinte num√©rique et anonymisation
            </p>
        </div>

        <!-- Server Status -->
        <div id="server-status" class="bg-red-900/50 backdrop-blur rounded-xl p-4 mb-6 border border-red-500">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-bold text-red-200">üî¥ Serveur FastAPI requis</h3>
                    <p class="text-red-300 text-sm">Le serveur Incogni-Me doit √™tre d√©marr√© pour utiliser cette interface</p>
                </div>
                <button onclick="checkServerStatus()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-500 transition-colors">
                    üîÑ V√©rifier
                </button>
            </div>
        </div>

        <!-- Login Section -->
        <div id="login-section" class="bg-gray-900/80 backdrop-blur rounded-xl p-6 mb-6 border border-gray-600">
            <h3 class="text-xl font-bold text-white mb-4">üîê Connexion</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-300 mb-2">Email :</label>
                            <input type="email" id="login-email" class="w-full bg-gray-800 text-white rounded-lg px-4 py-2 border border-gray-600" placeholder="votre@email.com">
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2">Mot de passe :</label>
                            <input type="password" id="login-password" class="w-full bg-gray-800 text-white rounded-lg px-4 py-2 border border-gray-600" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="login()" class="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-500 transition-colors">
                                üîë Se connecter
                            </button>
                            <button onclick="register()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-500 transition-colors">
                                üìù S'inscrire
                            </button>
                        </div>
                    </div>
                </div>
                <div class="bg-purple-900/30 p-4 rounded-lg">
                    <h4 class="font-bold text-purple-200 mb-2">‚ÑπÔ∏è Instructions</h4>
                    <div class="text-purple-300 text-sm space-y-2">
                        <p>1. D√©marrez le serveur FastAPI :</p>
                        <code class="bg-black/50 p-2 rounded block text-xs">python extensions/OSINT/Incogni-Me/src/main.py</code>
                        <p>2. Cr√©ez un compte ou connectez-vous</p>
                        <p>3. Ajoutez vos identit√©s √† surveiller</p>
                        <p>4. Lancez un scan de votre empreinte</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Interface (Hidden until logged in) -->
        <div id="main-interface" class="hidden">
            
            <!-- Identity Management -->
            <div class="bg-gray-900/80 backdrop-blur rounded-xl p-6 mb-6 border border-gray-600">
                <h3 class="text-xl font-bold text-white mb-4">üë§ Gestion des identit√©s</h3>
                <div class="flex gap-4 mb-4">
                    <input type="text" id="identity-input" class="flex-1 bg-gray-800 text-white rounded-lg px-4 py-2 border border-gray-600" placeholder="Email, nom d'utilisateur, nom complet...">
                    <button onclick="addIdentity()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-500 transition-colors">
                        ‚ûï Ajouter
                    </button>
                    <button onclick="startScan()" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-500 transition-colors">
                        üîç Scanner
                    </button>
                </div>
                <div id="identities-list" class="bg-black/30 p-4 rounded-lg">
                    <p class="text-gray-400 text-sm">Aucune identit√© ajout√©e</p>
                </div>
            </div>

            <!-- Scan Results -->
            <div class="bg-gray-900/80 backdrop-blur rounded-xl p-6 mb-6 border border-gray-600">
                <h3 class="text-xl font-bold text-white mb-4">üìä R√©sultats du scan</h3>
                <div id="scan-results" class="space-y-4">
                    <div class="text-gray-400 text-center py-8">
                        <p>üîç Aucun scan effectu√©</p>
                        <p class="text-sm mt-2">Ajoutez des identit√©s et lancez un scan pour voir votre empreinte num√©rique</p>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-red-900/50 p-4 rounded-lg border border-red-500">
                    <h4 class="font-bold text-red-200 mb-2">üóëÔ∏è Suppression</h4>
                    <p class="text-red-300 text-sm mb-3">Demander la suppression de donn√©es</p>
                    <button onclick="requestDeletion()" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-500 transition-colors">
                        Demander suppression
                    </button>
                </div>
                <div class="bg-yellow-900/50 p-4 rounded-lg border border-yellow-500">
                    <h4 class="font-bold text-yellow-200 mb-2">üìß Contact</h4>
                    <p class="text-yellow-300 text-sm mb-3">Contacter les plateformes</p>
                    <button onclick="contactPlatforms()" class="w-full bg-yellow-600 text-white py-2 rounded hover:bg-yellow-500 transition-colors">
                        G√©n√©rer emails
                    </button>
                </div>
                <div class="bg-green-900/50 p-4 rounded-lg border border-green-500">
                    <h4 class="font-bold text-green-200 mb-2">üìã Rapport</h4>
                    <p class="text-green-300 text-sm mb-3">Exporter les r√©sultats</p>
                    <button onclick="exportReport()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-500 transition-colors">
                        Exporter rapport
                    </button>
                </div>
            </div>
        </div>

        <!-- User Info (Hidden until logged in) -->
        <div id="user-info" class="hidden bg-purple-900/50 backdrop-blur rounded-xl p-4 border border-purple-500">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-purple-200">Connect√© en tant que : </span>
                    <span id="user-email" class="text-white font-bold"></span>
                </div>
                <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-500 transition-colors">
                    üö™ D√©connexion
                </button>
            </div>
        </div>

        <!-- Log Section -->
        <div class="mt-6 bg-black/50 rounded-lg p-4">
            <h4 class="text-white font-bold mb-2">üìã Journal Incogni-Me</h4>
            <div id="incogni-log" class="bg-black p-3 rounded text-purple-400 font-mono text-sm h-32 overflow-y-auto">
                [INIT] Incogni-Me Interface charg√©e
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let apiBaseUrl = 'http://localhost:8001';

        function logMessage(message, type = 'info') {
            const log = document.getElementById('incogni-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': 'text-purple-400',
                'warning': 'text-yellow-400',
                'error': 'text-red-400',
                'success': 'text-green-400'
            };
            const color = colors[type] || 'text-purple-400';
            log.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        async function checkServerStatus() {
            try {
                const response = await fetch(`${apiBaseUrl}/docs`);
                if (response.ok) {
                    document.getElementById('server-status').innerHTML = `
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-bold text-green-200">üü¢ Serveur FastAPI actif</h3>
                                <p class="text-green-300 text-sm">Le serveur Incogni-Me est accessible sur ${apiBaseUrl}</p>
                            </div>
                            <button onclick="window.open('${apiBaseUrl}/docs', '_blank')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-500 transition-colors">
                                üìñ API Docs
                            </button>
                        </div>
                    `;
                    document.getElementById('server-status').className = 'bg-green-900/50 backdrop-blur rounded-xl p-4 mb-6 border border-green-500';
                    logMessage('Serveur FastAPI d√©tect√© et accessible', 'success');
                } else {
                    throw new Error('Server not responding');
                }
            } catch (error) {
                logMessage('Serveur FastAPI non accessible - V√©rifiez qu\'il est d√©marr√©', 'error');
            }
        }

        async function register() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!email || !password) {
                logMessage('Email et mot de passe requis', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${apiBaseUrl}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    logMessage('Inscription r√©ussie - Vous pouvez maintenant vous connecter', 'success');
                } else {
                    const error = await response.json();
                    logMessage(`Erreur d'inscription: ${error.detail || 'Erreur inconnue'}`, 'error');
                }
            } catch (error) {
                logMessage(`Erreur de connexion au serveur: ${error.message}`, 'error');
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!email || !password) {
                logMessage('Email et mot de passe requis', 'error');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('username', email);
                formData.append('password', password);
                
                const response = await fetch(`${apiBaseUrl}/token`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentUser = {
                        email: email,
                        token: data.access_token
                    };
                    
                    document.getElementById('user-email').textContent = email;
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('main-interface').classList.remove('hidden');
                    document.getElementById('user-info').classList.remove('hidden');
                    
                    logMessage('Connexion r√©ussie', 'success');
                    loadUserData();
                } else {
                    const error = await response.json();
                    logMessage(`Erreur de connexion: ${error.detail || 'Identifiants incorrects'}`, 'error');
                }
            } catch (error) {
                logMessage(`Erreur de connexion au serveur: ${error.message}`, 'error');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('main-interface').classList.add('hidden');
            document.getElementById('user-info').classList.add('hidden');
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
            logMessage('D√©connexion r√©ussie', 'info');
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${apiBaseUrl}/users/me`, {
                    headers: { 'Authorization': `Bearer ${currentUser.token}` }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    displayIdentities(userData.identities || []);
                    loadFootprintItems();
                }
            } catch (error) {
                logMessage(`Erreur lors du chargement des donn√©es: ${error.message}`, 'error');
            }
        }

        function displayIdentities(identities) {
            const container = document.getElementById('identities-list');
            if (identities.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm">Aucune identit√© ajout√©e</p>';
                return;
            }
            
            container.innerHTML = identities.map(identity => `
                <div class="bg-gray-800 p-3 rounded-lg mb-2 flex items-center justify-between">
                    <span class="text-white">${identity.identity_value}</span>
                    <span class="text-xs text-gray-400">${identity.created_at}</span>
                </div>
            `).join('');
        }

        async function addIdentity() {
            const identity = document.getElementById('identity-input').value.trim();
            if (!identity || !currentUser) return;
            
            try {
                const response = await fetch(`${apiBaseUrl}/users/me/identities`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ identity_value: identity })
                });
                
                if (response.ok) {
                    document.getElementById('identity-input').value = '';
                    logMessage(`Identit√© ajout√©e: ${identity}`, 'success');
                    loadUserData();
                } else {
                    logMessage('Erreur lors de l\'ajout de l\'identit√©', 'error');
                }
            } catch (error) {
                logMessage(`Erreur: ${error.message}`, 'error');
            }
        }

        async function startScan() {
            if (!currentUser) return;
            
            logMessage('D√©marrage du scan de l\'empreinte num√©rique...', 'info');
            
            try {
                const response = await fetch(`${apiBaseUrl}/footprint/scan`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${currentUser.token}` }
                });
                
                if (response.ok) {
                    const results = await response.json();
                    logMessage(`Scan termin√© - ${results.length} √©l√©ments trouv√©s`, 'success');
                    loadFootprintItems();
                } else {
                    logMessage('Erreur lors du scan', 'error');
                }
            } catch (error) {
                logMessage(`Erreur de scan: ${error.message}`, 'error');
            }
        }

        async function loadFootprintItems() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${apiBaseUrl}/footprint/items`, {
                    headers: { 'Authorization': `Bearer ${currentUser.token}` }
                });
                
                if (response.ok) {
                    const items = await response.json();
                    displayScanResults(items);
                }
            } catch (error) {
                logMessage(`Erreur lors du chargement: ${error.message}`, 'error');
            }
        }

        function displayScanResults(items) {
            const container = document.getElementById('scan-results');
            
            if (items.length === 0) {
                container.innerHTML = `
                    <div class="text-gray-400 text-center py-8">
                        <p>üîç Aucun r√©sultat de scan</p>
                        <p class="text-sm mt-2">Lancez un scan pour d√©couvrir votre empreinte num√©rique</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = items.map(item => `
                <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-white">${item.platform}</h4>
                        <span class="text-xs px-2 py-1 rounded ${getStatusColor(item.status)}">${item.status}</span>
                    </div>
                    <p class="text-gray-300 text-sm mb-2">${item.type}</p>
                    <a href="${item.url}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm break-all">${item.url}</a>
                    <div class="mt-3 flex gap-2">
                        <button onclick="requestItemDeletion(${item.id})" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-500">
                            üóëÔ∏è Supprimer
                        </button>
                        <button onclick="markAsHandled(${item.id})" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-500">
                            ‚úÖ Trait√©
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            switch(status) {
                case 'FOUND': return 'bg-yellow-600 text-white';
                case 'REMOVAL_REQUESTED': return 'bg-orange-600 text-white';
                case 'REMOVED': return 'bg-green-600 text-white';
                default: return 'bg-gray-600 text-white';
            }
        }

        async function requestItemDeletion(itemId) {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${apiBaseUrl}/footprint/items/${itemId}/request`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        item_id: itemId,
                        request_type: 'REMOVAL',
                        message: 'Demande de suppression automatique via Incogni-Me'
                    })
                });
                
                if (response.ok) {
                    logMessage('Demande de suppression envoy√©e', 'success');
                    loadFootprintItems();
                } else {
                    logMessage('Erreur lors de la demande de suppression', 'error');
                }
            } catch (error) {
                logMessage(`Erreur: ${error.message}`, 'error');
            }
        }

        function requestDeletion() {
            logMessage('Fonction de suppression globale - √Ä impl√©menter', 'info');
        }

        function contactPlatforms() {
            logMessage('G√©n√©ration d\'emails de contact - √Ä impl√©menter', 'info');
        }

        function exportReport() {
            logMessage('Export de rapport - √Ä impl√©menter', 'info');
        }

        // Initialize
        logMessage('Interface Incogni-Me pr√™te', 'success');
        checkServerStatus();
    </script>
</body>
</html>