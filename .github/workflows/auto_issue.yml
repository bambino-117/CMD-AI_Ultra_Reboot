name: ğŸ¤– CrÃ©ation automatique d'Issues

on:
  repository_dispatch:
    types: [tester-report]

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: CrÃ©er Issue depuis rapport testeur
        uses: actions/github-script@v6
        with:
          script: |
            const { data } = context.payload.client_payload;
            
            const title = data.is_tester ? 
              `[TESTEUR] ${data.error_type} - ${data.user_pseudo}` : 
              `[BUG] ${data.error_type} - ${data.user_pseudo}`;
            
            const body = `## ğŸ› Description du problÃ¨me
            ${data.description || 'Erreur automatiquement dÃ©tectÃ©e'}
            
            ## ğŸ’» Informations systÃ¨me
            **OS:** ${data.system.os}
            **Version Python:** ${data.system.python}
            **Version CMD-AI:** ${data.system.app_version}
            **Architecture:** ${data.system.arch}
            
            ## âŒ Erreur rencontrÃ©e
            \`\`\`
            ${data.error_traceback}
            \`\`\`
            
            ## ğŸ“Š Logs
            \`\`\`
            ${data.logs}
            \`\`\`
            
            ## ğŸ‘¤ ${data.is_tester ? 'Testeur' : 'Utilisateur'}
            **ID:** ${data.user_pseudo}
            **Statut:** ${data.is_tester ? 'ğŸ§ª Testeur officiel' : 'ğŸ‘¤ Utilisateur'}
            **Niveau technique:** ${data.user_level}
            **PremiÃ¨re utilisation:** ${data.first_time ? 'Oui' : 'Non'}
            
            ---
            *Rapport gÃ©nÃ©rÃ© automatiquement le ${data.timestamp} par CMD-AI Ultra Reboot*`;
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['bug', 'tester-feedback', 'auto-generated']
            });